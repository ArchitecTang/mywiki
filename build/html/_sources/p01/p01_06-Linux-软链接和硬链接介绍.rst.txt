.. contents::
   :depth: 3
..

1.6 Linux-软链接和硬链接
========================

1.6.1 硬链接（Hard Link）
-------------------------

含义

硬链接共用同一个inode号，只是文件名不同。

查找文件的步骤

当我们查找一个硬链接文件，比如/root/test-hard时，要经过以下步骤：

::

   1）首先找到根目录的inode（根目录的inode是系统已知的，inode号是2），然后判断用户是否有权限访问根目录的block。

   2）如果有权限，则可以在根目录的block中访问到/root的文件名及对应的inode号。

   3）通过/root/目录的inode号，可以查找到/root/目录的inode信息，接着判断用户是否有权限访问/root/目录的block。

   4）如果有权限，则可以从/root/目录的block中读取到test-hard文件的文件名及对应的inode号。

   5）通过test-hard文件的inode号，就可以找到test-hard文件的inode信息，接着判断用户是否有权限访问test-hard文件的block。

   6）如果有权限，则可以读取block中的数据，这样就完成了/root/test-hard文件的读取与访问。

硬链接的特点

::

   1）不论是修改源文件（test文件），还是修改硬链接文件（test-hard文件），另一个文件中的数据都会发生改变。

   2）不论是删除源文件，还是删除硬链接文件，只要还有一个文件存在，这个文件都可以被访问。

   3）硬链接不会建立新的inode信息，也不会更改inode的总数。

   4）硬链接不能跨文件系统（分区）建立，因为在不同的文件系统中，inode号是重新计算的。

   5）硬链接不能链接目录，因为如果给目录建立硬链接，那么不仅目录本身需要重新建立，目录下所有的子文件，包括子目录中的所有子文件都需要建立硬链接，这对当前的Linux来讲过于复杂。

   6）硬链接不会占用inode和block。

1.6.2 软链接（Symbolic link）
-----------------------------

含义

软链接有着自己的inode号以及用户数据块。只不过用户数据块中存放的内容是另一文件的路径名的指向。

查找文件的步骤

当我们查找一个软链接文件，比如/root/test-soft时，要经过以下步骤：

::

   1）首先找到根目录的inode索引信息，然后判断用户是否有权限访问根目录的block。

   2）如果有权限访问根目录的block，就会在block中查找到/root/目录的inode号。

   3）接着访问/root/目录的inode信息，判断用户是否有权限访问/root/目录的block。

   4）如果有权限，就会在block中读取到软链接文件test-soft的inode号。因为软链接文件会真正建立自己的inode索引和block，所以软链接文件和源文件的inode号是不一样的。

   5）通过软链接文件的inode号，找到了test-soft文件inode信息，判断用户是否有权限访问block。

   6）如果有权限，就会发现test-soft文件的block中没有实际数据，仅有源文件test的inode号。

   7）接着通过源文件的inode号，访问到源文件test的inode信息，判断用户是否有权限访问block。

   8）如果有权限，就会在test文件的block中读取到真正的数据，从而完成数据访问。

软连接的特点

::

   1）不论是修改源文件（test），还是修改硬链接文件（test-soft)，另一个文件中的数据都会发生改变。

   2）删除软链接文件，源文件不受影响。而删除原文件，软链接文件将找不到实际的数据，从而显示文件不存在。

   3）软链接会新建自己的inode信息和block，只是在block中不存储实际文件数据，而存储的是源文件的文件名及inode号。

   4）软链接可以链接目录。

   5）软链接可以跨分区。

   6）软链接会占用inode和block。

`原文来自：https://www.linuxprobe.com/about-linux-link.html <https://www.linuxprobe.com/about-linux-link.html>`__
